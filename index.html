<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dumb Charades Game</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css');
        
        .card {
            @apply bg-gray-800 rounded-2xl shadow-lg border border-gray-700 p-6 !important;
        }
        
        .btn-primary {
            @apply px-4 py-2 rounded-xl font-medium bg-blue-600 text-white hover:bg-blue-700 transition-all duration-200 !important;
        }
        
        .btn-secondary {
            @apply px-4 py-2 rounded-xl font-medium bg-gray-700 text-white hover:bg-gray-600 transition-all duration-200 !important;
        }
        
        .btn-success {
            @apply px-10 py-5 rounded-full text-xl font-bold bg-gradient-to-r from-green-400 to-green-600 text-white hover:from-green-500 hover:to-green-700 transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 border-2 border-white/20 !important;
        }
        
        .btn-danger {
            @apply px-10 py-5 rounded-full text-xl font-bold bg-gradient-to-r from-red-400 to-red-600 text-white hover:from-red-500 hover:to-red-700 transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 border-2 border-white/20 !important;
        }
        
        .btn-pass {
            @apply px-10 py-5 rounded-full text-xl font-bold bg-gradient-to-r from-yellow-400 to-yellow-600 text-white hover:from-yellow-500 hover:to-yellow-700 transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 border-2 border-white/20 !important;
        }
        
        .btn-toggle {
            @apply px-8 py-4 rounded-full text-lg font-bold bg-gradient-to-r from-gray-500 to-gray-600 text-white hover:from-gray-600 hover:to-gray-700 transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 border-2 border-white/20 !important;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
    <div id="app" class="max-w-3xl mx-auto p-4">
        <!-- Header -->
        <h1 class="text-3xl font-extrabold mb-6 text-center">Dumb Charades üé≠</h1>
        
        <!-- Theme Toggle -->
        <div class="flex items-center justify-between mb-4">
            <div></div>
            <div class="flex items-center gap-2">
                <label class="text-sm opacity-80">Theme</label>
                <button id="themeToggle" class="btn-secondary" type="button">‚òÄÔ∏è Light</button>
            </div>
        </div>
        
        <!-- Scoreboard -->
        <div class="card mb-6">
            <div class="flex justify-between items-center">
                <div id="teamScores" class="flex gap-8">
                    <!-- Team scores will be populated by JS -->
                </div>
                <button id="resetScores" class="btn-danger" type="button">Reset</button>
            </div>
        </div>
        
        <!-- Tabs -->
        <div class="mb-6">
            <div class="grid grid-cols-3 gap-1 bg-gray-800 rounded-xl p-1">
                <button class="tab-btn py-2 px-4 rounded-lg text-sm font-medium bg-gray-700 shadow-sm" data-tab="play" type="button">Play</button>
                <button class="tab-btn py-2 px-4 rounded-lg text-sm font-medium hover:bg-gray-700/50" data-tab="settings" type="button">Settings</button>
                <button class="tab-btn py-2 px-4 rounded-lg text-sm font-medium hover:bg-gray-700/50" data-tab="score" type="button">Scoreboard</button>
            </div>
        </div>
        
        <!-- Tab Content -->
        <div id="playTab" class="tab-content">
            <div class="space-y-6">
                <div id="gameArea">
                    <button id="startRound" class="w-full px-6 py-4 rounded-2xl bg-gradient-to-r from-fuchsia-400 to-blue-400 text-white font-semibold shadow-lg hover:opacity-90 border-2 border-white/20" type="button">
                        Start Round
                    </button>
                </div>
            </div>
        </div>
        
        <div id="settingsTab" class="tab-content hidden">
            <div class="card">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Round Duration (sec)</label>
                        <input type="number" id="duration" value="60" class="w-full px-3 py-2 rounded-xl bg-gray-700 text-white">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Source</label>
                        <select id="source" class="w-full px-3 py-2 rounded-xl bg-gray-700 text-white">
                            <option value="local">Local Bank</option>
                            <option value="tmdb_hollywood">TMDb (Hollywood)</option>
                            <option value="tmdb_bollywood">TMDb (Bollywood)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Language</label>
                        <select id="language" class="w-full px-3 py-2 rounded-xl bg-gray-700 text-white">
                            <option value="en">English</option>
                            <option value="hi">Hindi</option>
                            <option value="mixed">Mixed</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="scoreTab" class="tab-content hidden">
            <div class="card">
                <div id="detailedScores" class="space-y-3">
                    <!-- Detailed scores will be populated by JS -->
                </div>
                <div class="flex justify-end mt-4">
                    <button id="resetDetailedScores" class="btn-danger" type="button">Reset Scores</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            teams: [
                { id: 'team1', name: 'Team A', score: 0 },
                { id: 'team2', name: 'Team B', score: 0 }
            ],
            settings: {
                duration: 60,
                source: 'local',
                lang: 'mixed'
            },
            current: null,
            timeLeft: 0,
            activeTeam: 'team1',
            darkMode: true,
            activeTab: 'play',
            history: [],
            isPromptHidden: false
        };

        // Prompt Bank (Expanded)
        const promptBank = {
            en: [
                "Titanic", "Inception", "The Matrix", "Avatar", "Forrest Gump",
                "The Godfather", "Pulp Fiction", "Jurassic Park", "Star Wars", "Harry Potter",
                "The Shawshank Redemption", "Fight Club", "The Dark Knight", "Schindler's List",
                "Gladiator", "The Lord of the Rings", "The Avengers", "Interstellar", "La La Land",
                "Mad Max: Fury Road", "The Lion King", "Back to the Future", "Blade Runner"
            ],
            hi: [
                { roman: "Sholay", devanagari: "‡§∂‡•ã‡§≤‡•á" },
                { roman: "Dilwale Dulhania Le Jayenge", devanagari: "‡§¶‡§ø‡§≤‡§µ‡§æ‡§≤‡•á ‡§¶‡•Å‡§≤‡•ç‡§π‡§®‡§ø‡§Ø‡§æ ‡§≤‡•á ‡§ú‡§æ‡§è‡§Ç‡§ó‡•á" },
                { roman: "3 Idiots", devanagari: "3 ‡§á‡§°‡§ø‡§Ø‡§ü‡•ç‡§∏" },
                { roman: "Dangal", devanagari: "‡§¶‡§Ç‡§ó‡§≤" },
                { roman: "Lagaan", devanagari: "‡§≤‡§ó‡§æ‡§®" },
                { roman: "Mughal-E-Azam", devanagari: "‡§Æ‡•Å‡§ó‡§≤-‡§è-‡§Ü‡§ú‡§Æ" },
                { roman: "Andhadhun", devanagari: "‡§Ö‡§Ç‡§ß‡§æ‡§ß‡•Å‡§®" },
                { roman: "Gully Boy", devanagari: "‡§ó‡§≤‡•Ä ‡§¨‡•â‡§Ø" },
                { roman: "Zindagi Na Milegi Dobara", devanagari: "‡§ú‡§ø‡§Ç‡§¶‡§ó‡•Ä ‡§®‡§æ ‡§Æ‡§ø‡§≤‡•á‡§ó‡•Ä ‡§¶‡•ã‡§¨‡§æ‡§∞‡§æ" },
                { roman: "Queen", devanagari: "‡§ï‡•ç‡§µ‡•Ä‡§®" },
                { roman: "Bajrangi Bhaijaan", devanagari: "‡§¨‡§ú‡§∞‡§Ç‡§ó‡•Ä ‡§≠‡§æ‡§à‡§ú‡§æ‡§®" },
                { roman: "PK", devanagari: "‡§™‡•Ä‡§ï‡•á" },
                { roman: "Barfi!", devanagari: "‡§¨‡§∞‡•ç‡§´‡•Ä!" },
                { roman: "Kabhi Khushi Kabhie Gham", devanagari: "‡§ï‡§≠‡•Ä ‡§ñ‡§º‡•Å‡§∂‡•Ä ‡§ï‡§≠‡•Ä ‡§ó‡§º‡§Æ" },
                { roman: "Padmaavat", devanagari: "‡§™‡§¶‡•ç‡§Æ‡§æ‡§µ‡§§" },
                { roman: "Bhaag Milkha Bhaag", devanagari: "‡§≠‡§æ‡§ó ‡§Æ‡§ø‡§≤‡•ç‡§ñ‡§æ ‡§≠‡§æ‡§ó" },
                { roman: "Swades", devanagari: "‡§∏‡•ç‡§µ‡§¶‡•á‡§∏" }
            ],
            mixed: []
        };
        promptBank.mixed = [
            ...promptBank.en,
            ...promptBank.hi.map(item => item.roman),
            ...promptBank.hi.map(item => item.devanagari)
        ];

        // TMDB API Key
        const TMDB_KEY = "73d810661de60fdebce5436ea8392d23";

        // Utility Functions
        const nid = () => Math.random().toString(36).slice(2);
        const fmtTime = (s) => `${Math.floor(s / 60)}:${(s % 60).toString().padStart(2, "0")}`;
        const randomItem = (arr) => arr[Math.floor(Math.random() * arr.length)];

        // Local Storage
        const saveState = () => {
            Object.keys(gameState).forEach(key => {
                if (key !== 'current' && key !== 'timeLeft') {
                    localStorage.setItem(`charades_${key}`, JSON.stringify(gameState[key]));
                }
            });
        };

        const loadState = () => {
            Object.keys(gameState).forEach(key => {
                const saved = localStorage.getItem(`charades_${key}`);
                if (saved) {
                    try {
                        gameState[key] = JSON.parse(saved);
                    } catch (e) {
                        console.error(`Error loading ${key}:`, e);
                    }
                }
            });
        };

        // Timer
        let timerInterval;
        const startTimer = () => {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                if (gameState.timeLeft > 0) {
                    gameState.timeLeft--;
                    updateGameDisplay();
                } else {
                    clearInterval(timerInterval);
                    // Time's up sound
                    playBuzzer();
                }
            }, 1000);
        };

        const playBuzzer = () => {
            // Simple buzzer sound using Web Audio API
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 440;
                oscillator.type = 'square';
                gainNode.gain.value = 0.1;
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                console.log('Audio not supported');
            }
        };

        // Toggle Prompt Visibility
        const togglePrompt = () => {
            gameState.isPromptHidden = !gameState.isPromptHidden;
            updateGameDisplay();
            saveState();
        };

        // Get New Prompt
        const getNewPrompt = async (keepTeam = false) => {
            try {
                let prompt;
                
                // Switch active team unless keepTeam is true
                if (!keepTeam) {
                    gameState.activeTeam = gameState.activeTeam === 'team1' ? 'team2' : 'team1';
                }
                
                if (gameState.settings.source === 'local') {
                    const list = gameState.settings.lang === 'hi' 
                        ? promptBank.hi.map(item => item.devanagari)
                        : gameState.settings.lang === 'en' 
                        ? promptBank.hi.map(item => item.roman)
                        : promptBank.mixed;
                    const available = list.filter(word => !gameState.history.some(h => h.text.toLowerCase() === word.toLowerCase()));
                    if (available.length === 0) {
                        gameState.history = []; // Reset history when pool is exhausted
                    }
                    const pool = available.length ? available : list;
                    const text = randomItem(pool) || "(no prompt)";
                    prompt = { id: nid(), text, source: 'local' };
                } else {
                    // Randomize page to access broader movie pool (1 to 500)
                    const page = Math.floor(Math.random() * 500) + 1;
                    const originalLang = gameState.settings.source === 'tmdb_bollywood' ? 'hi' : 'en';
                    const displayLang = gameState.settings.lang === 'mixed' 
                        ? (Math.random() > 0.5 ? 'en-US' : 'hi-IN') 
                        : (gameState.settings.lang === 'hi' ? 'hi-IN' : 'en-US');
                    
                    const url = `https://api.themoviedb.org/3/discover/movie?with_original_language=${originalLang}&language=${displayLang}&sort_by=popularity.desc&page=${page}&api_key=${TMDB_KEY}`;
                    
                    const res = await fetch(url);
                    if (!res.ok) throw new Error(`TMDb error ${res.status}`);
                    const data = await res.json();
                    const results = data.results || [];
                    const available = results.filter(m => !gameState.history.some(h => h.text.toLowerCase() === (m.original_title || m.title).toLowerCase()));
                    const pool = available.length ? available : results;
                    const pick = randomItem(pool);
                    if (pick) {
                        const isHindiDisplay = gameState.settings.lang === 'hi' || (gameState.settings.lang === 'mixed' && displayLang === 'hi-IN');
                        const title = isHindiDisplay 
                            ? (pick.title || pick.original_title || "(untitled)")
                            : (pick.original_title || pick.title || "(untitled)");
                        prompt = { 
                            id: String(pick.id), 
                            text: title, 
                            source: gameState.settings.source 
                        };
                    }
                }

                if (prompt) {
                    gameState.current = prompt;
                    gameState.history = [prompt, ...gameState.history].slice(0, 100);
                    gameState.timeLeft = gameState.settings.duration;
                    gameState.isPromptHidden = false; // Show new prompt by default
                    startTimer();
                    updateGameDisplay();
                }
            } catch (err) {
                console.error('Error getting prompt:', err);
                // Fallback to local
                const list = gameState.settings.lang === 'hi' 
                    ? promptBank.hi.map(item => item.devanagari)
                    : gameState.settings.lang === 'en' 
                    ? promptBank.hi.map(item => item.roman)
                    : promptBank.mixed;
                const available = list.filter(word => !gameState.history.some(h => h.text.toLowerCase() === word.toLowerCase()));
                if (available.length === 0) {
                    gameState.history = []; // Reset history when pool is exhausted
                }
                const pool = available.length ? available : list;
                const text = randomItem(pool) || "(no prompt)";
                const prompt = { id: nid(), text, source: 'local' };
                gameState.current = prompt;
                gameState.history = [prompt, ...gameState.history].slice(0, 100);
                gameState.timeLeft = gameState.settings.duration;
                gameState.isPromptHidden = false; // Show new prompt by default
                startTimer();
                updateGameDisplay();
            }
        };

        // Pass Prompt
        const passPrompt = () => {
            getNewPrompt(true); // Keep the current team
        };

        // Update Score
        const updateScore = (delta) => {
            const team = gameState.teams.find(t => t.id === gameState.activeTeam);
            if (team) {
                team.score += delta;
            }
            gameState.current = null;
            gameState.timeLeft = 0;
            gameState.isPromptHidden = false;
            clearInterval(timerInterval);
            updateDisplay();
            saveState();
        };

        // Reset Scores
        const resetScores = () => {
            gameState.teams.forEach(team => team.score = 0);
            updateDisplay();
            saveState();
        };

        // Update Display
        const updateDisplay = () => {
            updateScoreboard();
            updateTabs();
            updateSettings();
            updateGameDisplay();
        };

        const updateScoreboard = () => {
            const teamScores = document.getElementById('teamScores');
            const detailedScores = document.getElementById('detailedScores');
            
            teamScores.innerHTML = gameState.teams.map(team => `
                <div class="flex flex-col items-center">
                    <span class="font-bold">${team.name}</span>
                    <span class="text-2xl">${team.score}</span>
                </div>
            `).join('');
            
            detailedScores.innerHTML = gameState.teams.map(team => `
                <div class="flex justify-between text-lg font-medium">
                    <span>${team.name}</span>
                    <span>${team.score}</span>
                </div>
            `).join('');
        };

        const updateTabs = () => {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.getElementById(`${gameState.activeTab}Tab`).classList.remove('hidden');
            
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('bg-gray-700', 'shadow-sm');
                btn.classList.add('hover:bg-gray-700/50');
            });
            
            const activeBtn = document.querySelector(`[data-tab="${gameState.activeTab}"]`);
            if (activeBtn) {
                activeBtn.classList.add('bg-gray-700', 'shadow-sm');
                activeBtn.classList.remove('hover:bg-gray-700/50');
            }
        };

        const updateSettings = () => {
            document.getElementById('duration').value = gameState.settings.duration;
            document.getElementById('source').value = gameState.settings.source;
            document.getElementById('language').value = gameState.settings.lang;
        };

        const updateGameDisplay = () => {
            const gameArea = document.getElementById('gameArea');
            
            if (gameState.current) {
                gameArea.innerHTML = `
                    <div class="card">
                        <div class="space-y-8 text-center">
                            <div class="text-2xl font-bold">
                                ${gameState.isPromptHidden ? 'Prompt Hidden' : gameState.current.text}
                            </div>
                            <div class="text-5xl font-bold text-white bg-gray-700/50 rounded-lg p-4">
                                ‚è≥ ${fmtTime(gameState.timeLeft)}
                            </div>
                            <div class="flex justify-center">
                                <button id="togglePromptBtn" class="btn-toggle" type="button">
                                    ${gameState.isPromptHidden ? 'Show Prompt' : 'Hide Prompt'}
                                </button>
                            </div>
                            <div class="flex justify-center">
                                <select id="activeTeamSelect" class="mx-auto w-40 px-3 py-2 rounded-xl bg-gray-700 text-white">
                                    ${gameState.teams.map(team => 
                                        `<option value="${team.id}" ${team.id === gameState.activeTeam ? 'selected' : ''}>${team.name}</option>`
                                    ).join('')}
                                </select>
                            </div>
                            <div class="flex justify-center gap-6">
                                <button id="guessedBtn" class="w-36 btn-success" type="button">‚úÖ Guessed</button>
                                <button id="notGuessedBtn" class="w-36 btn-danger" type="button">‚ùå Not Guessed</button>
                                <button id="passBtn" class="w-36 btn-pass" type="button">‚è≠Ô∏è Pass</button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('activeTeamSelect').addEventListener('change', (e) => {
                    gameState.activeTeam = e.target.value;
                    saveState();
                });
                
                document.getElementById('guessedBtn').addEventListener('click', () => updateScore(1));
                document.getElementById('notGuessedBtn').addEventListener('click', () => updateScore(0));
                document.getElementById('passBtn').addEventListener('click', passPrompt);
                document.getElementById('togglePromptBtn').addEventListener('click', togglePrompt);
            } else {
                gameArea.innerHTML = `
                    <button id="startRound" class="w-full px-6 py-4 rounded-2xl bg-gradient-to-r from-fuchsia-400 to-blue-400 text-white font-semibold shadow-lg hover:opacity-90 border-2 border-white/20" type="button">
                        Start Round
                    </button>
                `;
                
                document.getElementById('startRound').addEventListener('click', () => getNewPrompt(false));
            }
        };

        // Theme Toggle
        const toggleTheme = () => {
            gameState.darkMode = !gameState.darkMode;
            document.documentElement.classList.toggle('dark', gameState.darkMode);
            document.getElementById('themeToggle').textContent = gameState.darkMode ? '‚òÄÔ∏è Light' : 'üåô Dark';
            saveState();
        };

        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            loadState();
            
            // Apply dark mode
            document.documentElement.classList.toggle('dark', gameState.darkMode);
            
            // Event listeners
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
            document.getElementById('resetScores').addEventListener('click', resetScores);
            document.getElementById('resetDetailedScores').addEventListener('click', resetScores);
            
            // Tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    gameState.activeTab = btn.dataset.tab;
                    updateDisplay();
                    saveState();
                });
            });
            
            // Settings
            document.getElementById('duration').addEventListener('change', (e) => {
                gameState.settings.duration = parseInt(e.target.value);
                saveState();
            });
            
            document.getElementById('source').addEventListener('change', (e) => {
                gameState.settings.source = e.target.value;
                saveState();
            });
            
            document.getElementById('language').addEventListener('change', (e) => {
                gameState.settings.lang = e.target.value;
                saveState();
            });
            
            // Initial display
            updateDisplay();
        });
    </script>
</body>
</html>
