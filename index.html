<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dumb Charades Game</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üé¨</text></svg>">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css');
        
        .card {
            @apply bg-gray-800 rounded-2xl shadow-lg border border-gray-700 p-3;
        }
        
        .light .card {
            @apply bg-white border-gray-200 text-gray-900;
        }
        
        .btn-primary {
            @apply px-4 py-2 rounded-xl font-medium bg-blue-600 text-white hover:bg-blue-700 transition-all duration-200;
        }
        
        .light .btn-primary {
            @apply bg-blue-500 hover:bg-blue-600;
        }
        
        .btn-secondary {
            @apply px-4 py-2 rounded-xl font-medium bg-gray-700 text-white hover:bg-gray-600 transition-all duration-200;
        }
        
        .light .btn-secondary {
            @apply bg-gray-200 text-gray-900 hover:bg-gray-300;
        }
        
        .btn-toggle {
            @apply px-6 py-3 rounded-full text-base font-bold bg-gradient-to-r from-gray-500 to-gray-600 text-white hover:from-gray-600 hover:to-gray-700 transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 border-2 border-white/20;
        }
        
        .light .btn-toggle {
            @apply from-gray-300 to-gray-400 text-gray-900 border-gray-200;
        }
        
        .light {
            @apply bg-white text-gray-900;
        }
        
        .custom-btn {
            display: inline-block;
            padding: 12px 40px;
            font-size: 1.25rem;
            font-weight: bold;
            text-align: center;
            color: white;
            border-radius: 50px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }
        
        .custom-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .btn-guessed {
            background: linear-gradient(to right, #28a745, #218838);
        }
        
        .light .btn-guessed {
            background: linear-gradient(to right, #34c759, #28a745);
            border: 2px solid #e2e8f0;
        }
        
        .btn-not-guessed {
            background: linear-gradient(to right, #dc3545, #c82333);
        }
        
        .light .btn-not-guessed {
            background: linear-gradient(to right, #e4606d, #dc3545);
            border: 2px solid #e2e8f0;
        }
        
        .btn-pass {
            background: linear-gradient(to right, #ffc107, #e0a800);
        }
        
        .light .btn-pass {
            background: linear-gradient(to right, #ffca2c, #ffc107);
            border: 2px solid #e2e8f0;
        }
        
        .poster-img {
            max-width: 200px !important;
            height: auto !important;
            border-radius: 0.5rem;
            margin-left: auto;
            margin-right: auto;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-fit">
    <div id="app" class="max-w-3xl mx-auto p-4">
        <!-- Header -->
        <h1 class="text-3xl font-extrabold mb-6 text-center">Dumb Charades üé¨</h1>
        
        <!-- Theme Toggle -->
        <div class="flex items-center justify-between mb-4">
            <div></div>
            <div class="flex items-center gap-2">
                <label class="text-sm opacity-80">Theme</label>
                <button id="themeToggle" class="btn-secondary" type="button">‚òÄÔ∏è Light</button>
            </div>
        </div>
        
        <!-- Scoreboard -->
        <div class="card mb-6">
            <div class="flex justify-between items-center">
                <div id="teamScores" class="flex gap-8">
                    <!-- Team scores will be populated by JS -->
                </div>
                <button id="resetScores" class="btn-primary" type="button">Reset</button>
            </div>
        </div>
        
        <!-- Tabs -->
        <div class="mb-6">
            <div class="grid grid-cols-3 gap-1 bg-gray-800 rounded-xl p-1">
                <button class="tab-btn py-2 px-4 rounded-lg text-sm font-medium bg-gray-700 shadow-sm" data-tab="play" type="button">Play</button>
                <button class="tab-btn py-2 px-4 rounded-lg text-sm font-medium hover:bg-gray-700/50" data-tab="settings" type="button">Settings</button>
                <button class="tab-btn py-2 px-4 rounded-lg text-sm font-medium hover:bg-gray-700/50" data-tab="score" type="button">Scoreboard</button>
            </div>
        </div>
        
        <!-- Tab Content -->
        <div id="playTab" class="tab-content">
            <div class="space-y-2">
                <div id="gameArea">
                    <button id="startRound" class="w-full px-6 py-4 rounded-2xl bg-gradient-to-r from-fuchsia-400 to-blue-400 text-white font-semibold shadow-lg hover:opacity-90 border-2 border-white/20" type="button">
                        Start Round
                    </button>
                </div>
            </div>
        </div>
        
        <div id="settingsTab" class="tab-content hidden">
            <div class="card">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Round Duration (sec)</label>
                        <input type="number" id="duration" value="60" class="w-full px-3 py-2 rounded-xl bg-gray-700 text-white">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Language</label>
                        <select id="language" class="w-full px-3 py-2 rounded-xl bg-gray-700 text-white">
                            <option value="en">English</option>
                            <option value="hi">Hindi</option>
                            <option value="mixed">Mixed</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="scoreTab" class="tab-content hidden">
            <div class="card">
                <div id="detailedScores" class="space-y-3">
                    <!-- Detailed scores will be populated by JS -->
                </div>
                <div class="flex justify-end mt-4">
                    <button id="resetDetailedScores" class="btn-primary" type="button">Reset Scores</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            teams: [
                { id: 'team1', name: 'Team A', score: 0 },
                { id: 'team2', name: 'Team B', score: 0 }
            ],
            settings: {
                duration: 60,
                lang: 'mixed'
            },
            current: null,
            timeLeft: 0,
            activeTeam: 'team1',
            darkMode: true,
            activeTab: 'play',
            history: [],
            isPromptHidden: false,
            isDetailsHidden: true
        };

        // Prompt Bank (Expanded)
        const promptBank = {
            en: [
                "Titanic", "Inception", "The Matrix", "Avatar", "Forrest Gump",
                "The Godfather", "Pulp Fiction", "Jurassic Park", "Star Wars", "Harry Potter",
                "The Shawshank Redemption", "Fight Club", "The Dark Knight", "Schindler's List",
                "Gladiator", "The Lord of the Rings", "The Avengers", "Interstellar", "La La Land",
                "Mad Max: Fury Road", "The Lion King", "Back to the Future", "Blade Runner"
            ],
            hi: [
                { roman: "Sholay", devanagari: "‡§∂‡•ã‡§≤‡•á" },
                { roman: "Dilwale Dulhania Le Jayenge", devanagari: "‡§¶‡§ø‡§≤‡§µ‡§æ‡§≤‡•á ‡§¶‡•Å‡§≤‡•ç‡§π‡§®‡§ø‡§Ø‡§æ ‡§≤‡•á ‡§ú‡§æ‡§è‡§Ç‡§ó‡•á" },
                { roman: "3 Idiots", devanagari: "3 ‡§á‡§°‡§ø‡§Ø‡§ü‡•ç‡§∏" },
                { roman: "Dangal", devanagari: "‡§¶‡§Ç‡§ó‡§≤" },
                { roman: "Lagaan", devanagari: "‡§≤‡§ó‡§æ‡§®" },
                { roman: "Mughal-E-Azam", devanagari: "‡§Æ‡•Å‡§ó‡§≤-‡§è-‡§Ü‡§ú‡§Æ" },
                { roman: "Andhadhun", devanagari: "‡§Ö‡§Ç‡§ß‡§æ‡§ß‡•Å‡§®" },
                { roman: "Gully Boy", devanagari: "‡§ó‡§≤‡•Ä ‡§¨‡•â‡§Ø" },
                { roman: "Zindagi Na Milegi Dobara", devanagari: "‡§ú‡§ø‡§Ç‡§¶‡§ó‡•Ä ‡§®‡§æ ‡§Æ‡§ø‡§≤‡•á‡§ó‡•Ä ‡§¶‡•ã‡§¨‡§æ‡§∞‡§æ" },
                { roman: "Queen", devanagari: "‡§ï‡•ç‡§µ‡•Ä‡§®" },
                { roman: "Bajrangi Bhaijaan", devanagari: "‡§¨‡§ú‡§∞‡§Ç‡§ó‡•Ä ‡§≠‡§æ‡§à‡§ú‡§æ‡§®" },
                { roman: "PK", devanagari: "‡§™‡•Ä‡§ï‡•á" },
                { roman: "Barfi!", devanagari: "‡§¨‡§∞‡•ç‡§´‡•Ä!" },
                { roman: "Kabhi Khushi Kabhie Gham", devanagari: "‡§ï‡§≠‡•Ä ‡§ñ‡§º‡•Å‡§∂‡•Ä ‡§ï‡§≠‡•Ä ‡§ó‡§º‡§Æ" },
                { roman: "Padmaavat", devanagari: "‡§™‡§¶‡•ç‡§Æ‡§æ‡§µ‡§§" },
                { roman: "Bhaag Milkha Bhaag", devanagari: "‡§≠‡§æ‡§ó ‡§Æ‡§ø‡§≤‡•ç‡§ñ‡§æ ‡§≠‡§æ‡§ó" },
                { roman: "Swades", devanagari: "‡§∏‡•ç‡§µ‡§¶‡•á‡§∏" }
            ],
            mixed: []
        };
        promptBank.mixed = [
            ...promptBank.en,
            ...promptBank.hi.map(item => item.roman),
            ...promptBank.hi.map(item => item.devanagari)
        ];

        // TMDB API Key
        const TMDB_KEY = "73d810661de60fdebce5436ea8392d23";

        // Genre List
        let genreList = [];
        const fetchGenres = async () => {
            try {
                const res = await fetch(`https://api.themoviedb.org/3/genre/movie/list?api_key=${TMDB_KEY}&language=en-US`);
                if (!res.ok) throw new Error(`Failed to fetch genres: ${res.status} ${res.statusText}`);
                const data = await res.json();
                genreList = data.genres || [];
            } catch (err) {
                console.error('Error fetching genres:', err.message);
                genreList = [];
            }
        };

        // Utility Functions
        const nid = () => Math.random().toString(36).slice(2);
        const fmtTime = (s) => `${Math.floor(s / 60)}:${(s % 60).toString().padStart(2, "0")}`;
        const randomItem = (arr) => arr[Math.floor(Math.random() * arr.length)];

        // Local Storage
        const saveState = () => {
            Object.keys(gameState).forEach(key => {
                if (key !== 'current' && key !== 'timeLeft') {
                    localStorage.setItem(`charades_${key}`, JSON.stringify(gameState[key]));
                }
            });
        };

        const loadState = () => {
            Object.keys(gameState).forEach(key => {
                const saved = localStorage.getItem(`charades_${key}`);
                if (saved) {
                    try {
                        gameState[key] = JSON.parse(saved);
                    } catch (e) {
                        console.error(`Error loading ${key}:`, e);
                    }
                }
            });
        };

        // Timer
        let timerInterval;
        const startTimer = () => {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                if (gameState.timeLeft > 0) {
                    gameState.timeLeft--;
                    updateGameDisplay();
                } else {
                    clearInterval(timerInterval);
                    playBuzzer();
                }
            }, 1000);
        };

        const playBuzzer = () => {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 440;
                oscillator.type = 'square';
                gainNode.gain.value = 0.1;
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                console.log('Audio not supported');
            }
        };

        // Toggle Prompt Visibility
        const togglePrompt = () => {
            gameState.isPromptHidden = !gameState.isPromptHidden;
            updateGameDisplay();
            saveState();
        };

        // Toggle Details Visibility
        const toggleDetails = () => {
            gameState.isDetailsHidden = !gameState.isDetailsHidden;
            updateGameDisplay();
            saveState();
        };

        // Get New Prompt
        const getNewPrompt = async (keepTeam = false) => {
            let retries = 1;
            const maxRetries = 1;

            const fetchPrompt = async () => {
                try {
                    let prompt;
                    
                    if (!keepTeam) {
                        gameState.activeTeam = gameState.activeTeam === 'team1' ? 'team2' : 'team1';
                    }

                    let originalLang;
                    if (gameState.settings.lang === 'mixed') {
                        originalLang = Math.random() > 0.5 ? 'en' : 'hi';
                    } else {
                        originalLang = gameState.settings.lang === 'hi' ? 'hi' : 'en';
                    }
                    
                    const displayLang = gameState.settings.lang === 'mixed' 
                        ? (Math.random() > 0.5 ? 'en-US' : 'hi-IN') 
                        : (gameState.settings.lang === 'hi' ? 'hi-IN' : 'en-US');
                    
                    const page = Math.floor(Math.random() * 500) + 1;
                    
                    const url = `https://api.themoviedb.org/3/discover/movie?with_original_language=${originalLang}&language=${displayLang}&sort_by=popularity.desc&page=${page}&api_key=${TMDB_KEY}`;
                    
                    const res = await fetch(url);
                    if (!res.ok) throw new Error(`TMDb error: ${res.status} ${res.statusText}`);
                    const data = await res.json();
                    const results = data.results || [];
                    if (!results.length) throw new Error('No movies returned from TMDb');
                    
                    const available = results.filter(m => !gameState.history.some(h => h.text.toLowerCase() === (m.original_title || m.title).toLowerCase()));
                    const pool = available.length ? available : results;
                    const pick = randomItem(pool);
                    if (!pick) throw new Error('No valid movie selected');
                    
                    const creditsUrl = `https://api.themoviedb.org/3/movie/${pick.id}/credits?api_key=${TMDB_KEY}`;
                    const creditsRes = await fetch(creditsUrl);
                    const creditsData = creditsRes.ok ? await creditsRes.json() : { cast: [] };
                    const cast = creditsData.cast.slice(0, 3).map(actor => actor.name).join(', ') || 'Not available';
                    
                    const genres = pick.genre_ids && genreList.length
                        ? pick.genre_ids
                            .map(id => genreList.find(g => g.id === id)?.name)
                            .filter(Boolean)
                            .join(', ') || 'Not available'
                        : 'Not available';
                    
                    const isHindiDisplay = gameState.settings.lang === 'hi' || (gameState.settings.lang === 'mixed' && displayLang === 'hi-IN');
                    const title = isHindiDisplay 
                        ? (pick.title || pick.original_title || "(untitled)")
                        : (pick.original_title || pick.title || "(untitled)");
                    prompt = { 
                        id: String(pick.id), 
                        text: title,
                        cast: cast,
                        genres: genres,
                        release_date: pick.release_date || "Unknown",
                        link: `https://www.themoviedb.org/movie/${pick.id}`,
                        poster: pick.poster_path ? `https://image.tmdb.org/t/p/w500${pick.poster_path}` : null,
                        language: pick.original_language === 'hi' ? 'Hindi' : 'English'
                    };

                    if (prompt) {
                        gameState.current = prompt;
                        gameState.history = [prompt, ...gameState.history].slice(0, 100);
                        gameState.timeLeft = gameState.settings.duration;
                        gameState.isPromptHidden = false;
                        gameState.isDetailsHidden = true;
                        startTimer();
                        updateGameDisplay();
                    }
                } catch (err) {
                    throw err;
                }
            };

            while (retries >= 0) {
                try {
                    await fetchPrompt();
                    return;
                } catch (err) {
                    console.error(`Error getting prompt (Attempt ${maxRetries - retries + 1}): ${err.message}`);
                    retries--;
                    if (retries < 0) {
                        const list = gameState.settings.lang === 'hi' 
                            ? promptBank.hi.map(item => item.devanagari)
                            : gameState.settings.lang === 'en' 
                            ? promptBank.en
                            : promptBank.mixed;
                        const available = list.filter(word => !gameState.history.some(h => h.text.toLowerCase() === word.toLowerCase()));
                        if (available.length === 0) {
                            gameState.history = [];
                        }
                        const pool = available.length ? available : list;
                        const text = randomItem(pool) || "(no prompt)";
                        const language = gameState.settings.lang === 'hi' ? 'Hindi' : 
                                        gameState.settings.lang === 'en' ? 'English' : 
                                        (text in promptBank.en ? 'English' : 'Hindi');
                        const prompt = { 
                            id: nid(), 
                            text, 
                            cast: "Not available", 
                            genres: "Not available",
                            release_date: "Unknown", 
                            link: null, 
                            poster: null,
                            language
                        };
                        gameState.current = prompt;
                        gameState.history = [prompt, ...gameState.history].slice(0, 100);
                        gameState.timeLeft = gameState.settings.duration;
                        gameState.isPromptHidden = false;
                        gameState.isDetailsHidden = true;
                        startTimer();
                        updateGameDisplay();
                    }
                }
            }
        };

        // Pass Prompt
        const passPrompt = () => {
            getNewPrompt(true);
        };

        // Update Score
        const updateScore = (delta) => {
            const team = gameState.teams.find(t => t.id === gameState.activeTeam);
            if (team) {
                team.score += delta;
            }
            gameState.current = null;
            gameState.timeLeft = 0;
            gameState.isPromptHidden = false;
            gameState.isDetailsHidden = true;
            clearInterval(timerInterval);
            updateDisplay();
            saveState();
        };

        // Reset Scores
        const resetScores = () => {
            gameState.teams.forEach(team => team.score = 0);
            updateDisplay();
            saveState();
        };

        // Update Display
        const updateDisplay = () => {
            updateScoreboard();
            updateTabs();
            updateSettings();
            updateGameDisplay();
        };

        const updateScoreboard = () => {
            const teamScores = document.getElementById('teamScores');
            const detailedScores = document.getElementById('detailedScores');
            
            teamScores.innerHTML = gameState.teams.map(team => `
                <div class="flex flex-col items-center">
                    <span class="font-bold">${team.name}</span>
                    <span class="text-2xl">${team.score}</span>
                </div>
            `).join('');
            
            detailedScores.innerHTML = gameState.teams.map(team => `
                <div class="flex justify-between text-lg font-medium">
                    <span>${team.name}</span>
                    <span>${team.score}</span>
                </div>
            `).join('');
        };

        const updateTabs = () => {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.getElementById(`${gameState.activeTab}Tab`).classList.remove('hidden');
            
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('bg-gray-700', 'shadow-sm');
                btn.classList.add('hover:bg-gray-700/50');
            });
            
            const activeBtn = document.querySelector(`[data-tab="${gameState.activeTab}"]`);
            if (activeBtn) {
                activeBtn.classList.add('bg-gray-700', 'shadow-sm');
                activeBtn.classList.remove('hover:bg-gray-700/50');
            }
        };

        const updateSettings = () => {
            document.getElementById('duration').value = gameState.settings.duration;
            document.getElementById('language').value = gameState.settings.lang;
        };

        const updateGameDisplay = () => {
            const gameArea = document.getElementById('gameArea');
            
            if (gameState.current) {
                gameArea.innerHTML = `
                    <div class="card">
                        <div class="space-y-2 text-center">
                            ${gameState.isPromptHidden ? `
                                <div class="text-2xl font-bold">Prompt and Details Hidden</div>
                            ` : `
                                <div class="text-base font-bold">${gameState.current.text}</div>
                                <div class="text-xs font-medium">Language: ${gameState.current.language}</div>
                                ${!gameState.isDetailsHidden ? `
                                    ${gameState.current.poster ? `
                                        <img src="${gameState.current.poster}" alt="${gameState.current.text} poster" class="poster-img" style="max-width: 200px; height: auto; border-radius: 0.5rem; margin-left: auto; margin-right: auto;">
                                    ` : ''}
                                    <div class="text-xs opacity-80">
                                        Genres: ${gameState.current.genres}<br>
                                        Cast: ${gameState.current.cast}<br>
                                        Release Date: ${gameState.current.release_date}
                                        ${gameState.current.link ? `<br><a href="${gameState.current.link}" target="_blank" class="text-blue-400 hover:underline">View on TMDb</a>` : ''}
                                    </div>
                                ` : ''}
                            `}
                            <div class="flex justify-center gap-2">
                                <button id="togglePromptBtn" class="btn-toggle" type="button">
                                    ${gameState.isPromptHidden ? 'Show Prompt' : 'Hide Prompt'}
                                </button>
                                ${!gameState.isPromptHidden ? `
                                    <button id="toggleDetailsBtn" class="btn-toggle" type="button">
                                        ${gameState.isDetailsHidden ? 'Show Details' : 'Hide Details'}
                                    </button>
                                ` : ''}
                            </div>
                            <div class="text-5xl font-bold text-white bg-gray-700/50 rounded-lg p-4">
                                ‚è≥ ${fmtTime(gameState.timeLeft)}
                            </div>
                            <div class="flex justify-center">
                                <select id="activeTeamSelect" class="mx-auto w-40 px-3 py-2 rounded-xl bg-gray-700 text-white">
                                    ${gameState.teams.map(team => 
                                        `<option value="${team.id}" ${team.id === gameState.activeTeam ? 'selected' : ''}>${team.name}</option>`
                                    ).join('')}
                                </select>
                            </div>
                            <div class="flex justify-center gap-4">
                                <button id="guessedBtn" class="custom-btn btn-guessed" type="button">‚úÖ Guessed</button>
                                <button id="notGuessedBtn" class="custom-btn btn-not-guessed" type="button">‚ùå Not Guessed</button>
                                <button id="passBtn" class="custom-btn btn-pass" type="button">‚è≠Ô∏è Pass</button>
                            </div>
                        </div>
                    </div>
                `;
                
                const activeTeamSelect = document.getElementById('activeTeamSelect');
                if (activeTeamSelect) {
                    activeTeamSelect.addEventListener('change', (e) => {
                        gameState.activeTeam = e.target.value;
                        saveState();
                    });
                }
                
                const guessedBtn = document.getElementById('guessedBtn');
                if (guessedBtn) {
                    guessedBtn.addEventListener('click', () => updateScore(1));
                }
                
                const notGuessedBtn = document.getElementById('notGuessedBtn');
                if (notGuessedBtn) {
                    notGuessedBtn.addEventListener('click', () => updateScore(0));
                }
                
                const passBtn = document.getElementById('passBtn');
                if (passBtn) {
                    passBtn.addEventListener('click', passPrompt);
                }
                
                const togglePromptBtn = document.getElementById('togglePromptBtn');
                if (togglePromptBtn) {
                    togglePromptBtn.addEventListener('click', togglePrompt);
                }
                
                const toggleDetailsBtn = document.getElementById('toggleDetailsBtn');
                if (toggleDetailsBtn) {
                    toggleDetailsBtn.addEventListener('click', toggleDetails);
                }
            } else {
                gameArea.innerHTML = `
                    <button id="startRound" class="w-full px-6 py-4 rounded-2xl bg-gradient-to-r from-fuchsia-400 to-blue-400 text-white font-semibold shadow-lg hover:opacity-90 border-2 border-white/20" type="button">
                        Start Round
                    </button>
                `;
                
                const startRoundBtn = document.getElementById('startRound');
                if (startRoundBtn) {
                    startRoundBtn.addEventListener('click', () => getNewPrompt(false));
                }
            }
        };

        // Theme Toggle
        const toggleTheme = () => {
            gameState.darkMode = !gameState.darkMode;
            document.documentElement.classList.toggle('light', !gameState.darkMode);
            document.documentElement.classList.toggle('dark', gameState.darkMode);
            document.getElementById('themeToggle').textContent = gameState.darkMode ? '‚òÄÔ∏è Light' : 'üåô Dark';
            saveState();
        };

        // Event Listeners
        document.addEventListener('DOMContentLoaded', async () => {
            await fetchGenres();
            loadState();
            
            document.documentElement.classList.toggle('light', !gameState.darkMode);
            document.documentElement.classList.toggle('dark', gameState.darkMode);
            
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
            document.getElementById('resetScores').addEventListener('click', resetScores);
            document.getElementById('resetDetailedScores').addEventListener('click', resetScores);
            
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    gameState.activeTab = btn.dataset.tab;
                    updateDisplay();
                    saveState();
                });
            });
            
            document.getElementById('duration').addEventListener('change', (e) => {
                gameState.settings.duration = parseInt(e.target.value);
                saveState();
            });
            
            document.getElementById('language').addEventListener('change', (e) => {
                gameState.settings.lang = e.target.value;
                saveState();
            });
            
            updateDisplay();
        });
    </script>
</body>
</html>
